version: 2
jobs:
 build:
   machine: true

   working_directory: ~/repo

   steps:
     - checkout
     - restore_cache:
          name: Restore Yarn Package Cache
          keys:
            - yarn-packages-{{ .Branch }}-{{ checksum "yarn.lock" }}
            - yarn-packages-{{ .Branch }}
            - yarn-packages-master
            - yarn-packages-
     - run:
          name: Installing latest Git
          command: sudo add-apt-repository ppa:git-core/ppa -y && sudo apt-get update && sudo apt-get install realpath && sudo apt-get install git
     - run:
          name: Installing Node 8
          command: curl -sL https://deb.nodesource.com/setup_8.x | sudo -E bash - && sudo apt-get install -y nodejs
     - run:
          name: Installing Yarn
          command: sudo curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | sudo apt-key add - && sudo echo "deb https://dl.yarnpkg.com/debian/ stable main" | sudo tee /etc/apt/sources.list.d/yarn.list && sudo apt-get update && sudo apt-get install yarn
     - run:
          name: Verify Versions
          command: node --version && git --version && yarn --version
     - run:
          name: Installing dependencies
          command: yarn

     - save_cache:
          name: Save Yarn Package Cache
          key: yarn-packages-{{ .Branch }}-{{ checksum "yarn.lock" }}
          paths:
            - node_modules/

     - run: yarn test
